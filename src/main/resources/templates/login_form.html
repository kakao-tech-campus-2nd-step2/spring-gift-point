<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>로그인</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css"/>
  <link rel="stylesheet" href="/css/user_form.css"/>
</head>
<body>
<form id="loginForm">
  <div>
    <label>email: </label>
    <input type="email" id="userEmail">
  </div>
  <div>
    <label>password: </label>
    <input type="password" id="userPassword">
  </div>
  <div>
    <button type="submit">로그인</button>
  </div>
</form>
<div>
  <a th:href="@{/users/kakao/login}">카카오 로그인</a>
</div>
<script th:inline="javascript">
  document.getElementById('loginForm').addEventListener("submit", async function (event) {
    event.preventDefault();
    const user = {
      email: document.getElementById('userEmail').value,
      password: document.getElementById('userPassword').value
    };
    try {
      const response = await fetch(`/api/users/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(user)
      });

      if (response.ok) {
        const data = await response.json();
        localStorage.setItem('token', data.token);
        localStorage.setItem('userId', data.userId);
        alert("로그인 되었습니다.");
        window.location.href = /*[[@{/}]]*/ 'product_list.html';
      } else {
        const errorData = await response.json();
        alert(errorData.detail);
      }

    } catch (error) {
      alert("로그인 중 오류가 발생하였습니다.");
      console.error(error);
    }

  })
</script>
</body>
</html>
